# 配置文件

## validators
在`schema`文件中可以为`mapping`编写`validator`函数，去执行一些更高级的校验。

例如：
``` erlang
{mapping, "platform_len_limit", "msync.platform_len_limit", [
  {default, 10},
  {datatype, integer},
  {validators, [">=0", "<=50"]}
]}.

{validator, ">=0", "must be at least 0",
 fun(V) ->
    V >= 0
 end}.
{validator, "<=50", "50 and larger are not supported",
 fun(V) ->
    V =< 50
 end}.
```

如果把`platform_len_limit`的值设置为`-1`，生成配置文件会收到如下报错：
![](../img/20230919/1.png)

## 单元测试
``` erlang
   %% 仅通过schema文件生成配置
   Config = cuttlefish_unit:generate_templated_config(
               "../../lib/msync/priv/msync.schema", [], []),
   %% assert validator 设置的错误信息
   ok = cuttlefish_unit:assert_error_message(Config, "platform_len_limit invalid, must be at least 0").

```

``` erlang
   %% 通过 config 和 schema 共同生成配置
   LocalConfig = [{["platform_len_limit"], 10}],
   Config = cuttlefish_unit:generate_templated_config(
      "../../lib/msync/priv/msync.schema", LocalConfig, []),
   %% assert 生成的配置是否符合预期
   ok = cuttlefish_unit:assert_config(Config,   "msync.platform_len_limit", 10),
   %% assert 是否没有生成此配置
   ok = cuttlefish_unit:assert_not_configured(Config, "msync.roam_server").

```